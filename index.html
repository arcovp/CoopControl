<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hen Haven</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400..700&family=Shadows+Into+Light&family=Sofia&display=swap" rel="stylesheet">
    <style>    
    body {
        background-color: #92c4ac;
        font-family: "sofia", static;
        font-size: large;
        background-image: url('floralcoop.jpg');
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
    }
    .card {
        background-color: #f2f2f2;
        border-radius: 15px;
    }
    .card-header {
        background-color: #b8f7aa;
        color: white;
        font-weight: bold;
        border-bottom: none;
        border-radius: 0;
    }
    .form-control {
        background-color: #d7d3d3;
        border: none;
        border-radius: 5px;
    }
    .btn-primary {
        background-color: #Faa7d7;
        border: none;
        border-radius: 5px;
    }
    .btn-warning {
        background-color: #b8f7aa;
        border: none;
        border-radius: 5px;
    }
    .btn-outline-danger {
        border-color: #ff3c3c;
        color: #ff3c3c;
    }
    #btnSignUp:hover {
        background-color: #b0ec75;
        color: #fff
    }
    #btnSignUp {
        background-color: #b8f7aa;
        color: #fff
    }
    #btnLogin:hover {
        background-color: #f76ca6;
        color: #fff
    }
    #btnLogin {
        background-color: #faa7d7;
        color: #fff
    } 
    #btnRegister:hover {
        background-color: #f76ca6;
        color: #fff
    }
    #btnRegister {
        background-color: #faa7d7;
        color: #fff
    }   
    #registerCard {
        max-width: 500px;
        margin: 0 auto;
    } 
    /* Style labels */
    .form-group label {
        margin-bottom: 3px;
        margin-top:3px;
        display: block;
    }   
    .form-group input {
    width: 100%;
    display: inline-block;
    }
    /*labels with a class = required will have red * at then end so users know info is required */
    .required:after {
    content:" *";
    color: red;
    }
</style>
</head>
<body class="text-white">
    <div class="col-md-6 mx-auto card mt-5 mb-5 flex" id="loginCard">
        <div class="card-header text-center">
            <h1 style="font-size: 3rem;" id="lblLogin" aria-label="Login Header">Welcome to Hen Haven!</h1>
            <h2 style="font-size: 2rem;"> Where we hold our coops to high Eggs-pectations!</h2>
        </div>
        <div class="card-body">
            <form id="frmLogin" aria-label="Login Form">
                <!-- username info for login -->
                <label class="form-label" for="txtUsername" aria-label="Email Label">Email</label>
                <input class="form-control mb-3" id="txtUsername" type="email" required aria-label="Email Input">
                <!-- Password info for login -->
                <label class="form-label" for="txtPassword" aria-label="Password Label">Password</label>
                <input class="form-control" type="password" id="txtPassword" required aria-label="Password Input">
                <!-- btn for login -->
                <button class="btn col-12 mt-3" id="btnLogin" type="button" aria-label="Login Button" style="color:#fff">Login</button>
                <button class="btn col-12 btn-warning mt-3" id="btnSignUp" type="button" style="color:#fff" aria-label="Sign-Up Button">Sign-Up!</button>
            </form>
        </div>
    </div>
    <div class="col-md-6 mx-auto card mt-5 mb-5 flex" id="RegisterCard" style="display: none;">
        <div class="card-header text-center">
            <h2 style="font-size: 3rem;" id="lblRegistration" aria-label="Registration Header">Sign Up To Join The Haven Family!</h2>
        </div>
        <div class="card-body">
            <form id="frmRegistration" aria-label="Registration Form">
                <div class="form-group">
                    <!-- email info for registration -->
                    <label class="required" for="txtEmail" aria-label="Email Label">Email</label>
                    <input id="txtEmail" type="email" class="form-control" required aria-label="Email Input">
                    <!-- Password info for registration -->
                    <label class="required" for="txtRegisterPassword" aria-label="Password Label">Password</label>
                    <input id="txtRegisterPassword" type="password" class="form-control" required aria-label="Password Input">
                    <!-- FirstName info for registration -->
                    <label class="required" for="txtFirstName" aria-label="First Name Label">First Name</label>
                    <input id="txtFirstName" type="text" class="form-control" required aria-label="First Name Input">
                    <!-- LastName info for registration -->
                    <label class="required" for="txtLastName" aria-label="Last Name Label">Last Name</label>
                    <input id="txtLastName" type="text" class="form-control" required aria-label="Last Name Input">   
                    <!-- One street address info for registration -->
                    <label class="required" for="txtStreetAddress1">Street Address 1</label>
                    <input id="txtStreetAddress1" type="text" class="form-control">
                    <label for="txtStreetAddress2">Street Address 2 (optional)</label>
                    <input id="txtStreetAddress2" type="text" class="form-control">
                    <!-- Can assume no one will want chicken coops in apt so leave out apt number option -->
                </div>                    
                <div class="form-group">
                    <label class="required" for="txtCity">City</label>
                    <input id="txtCity" type="text" class="form-control" required>
                    <label class="required" for="txtCity">State</label>
                    <select class="form-control mt-1" id="txtState" aria-label="state" placeholder="State">
                        <option value="AL">Alabama</option>
                        <option value="AK">Alaska</option>
                        <option value="AZ">Arizona</option>
                        <option value="AR">Arkansas</option>
                        <option value="CA">California</option>
                        <option value="CO">Colorado</option>
                        <option value="CT">Connecticut</option>
                        <option value="DE">Delaware</option>
                        <option value="DC">District Of Columbia</option>
                        <option value="FL">Florida</option>
                        <option value="GA">Georgia</option>
                        <option value="HI">Hawaii</option>
                        <option value="ID">Idaho</option>
                        <option value="IL">Illinois</option>
                        <option value="IN">Indiana</option>
                        <option value="IA">Iowa</option>
                        <option value="KS">Kansas</option>
                        <option value="KY">Kentucky</option>
                        <option value="LA">Louisiana</option>
                        <option value="ME">Maine</option>
                        <option value="MD">Maryland</option>
                        <option value="MA">Massachusetts</option>
                        <option value="MI">Michigan</option>
                        <option value="MN">Minnesota</option>
                        <option value="MS">Mississippi</option>
                        <option value="MO">Missouri</option>
                        <option value="MT">Montana</option>
                        <option value="NE">Nebraska</option>
                        <option value="NV">Nevada</option>
                        <option value="NH">New Hampshire</option>
                        <option value="NJ">New Jersey</option>
                        <option value="NM">New Mexico</option>
                        <option value="NY">New York</option>
                        <option value="NC">North Carolina</option>
                        <option value="ND">North Dakota</option>
                        <option value="OH">Ohio</option>
                        <option value="OK">Oklahoma</option>
                        <option value="OR">Oregon</option>
                        <option value="PA">Pennsylvania</option>
                        <option value="RI">Rhode Island</option>
                        <option value="SC">South Carolina</option>
                        <option value="SD">South Dakota</option>
                        <option value="TN">Tennessee</option>
                        <option value="TX">Texas</option>
                        <option value="UT">Utah</option>
                        <option value="VT">Vermont</option>
                        <option value="VA">Virginia</option>
                        <option value="WA">Washington</option>
                        <option value="WV">West Virginia</option>
                        <option value="WI">Wisconsin</option>
                        <option value="WY">Wyoming</option>
                    </select>
                    <!-- Zip info for registration -->
                    <label class ="required" for="txtZipCode">Zip Code</label>
                    <input id="txtZipCode" type="number" placeholder="12345" class="form-control" required>
                    <!-- Phone num info for registration -->
                    <label class="required" for="txtPhoneNumber">Phone Number</label>
                    <input id="txtPhoneNumber" type="text" placeholder="(123) 456-7890" class="form-control" required>
                    <!-- coopID info for registration -->
                    <label class="required" id="txtCoopID">Coop ID</label>
                    <input id="txtCoopID" type="text" class="form-control mb-2" required>
                    <button id="btnRegister" class="btn btn-primary col-12 mt-3" type="button">Register</button>
                    <button id="btnCancel" class="btn btn-outline-danger col-12 mt-3" type="button">Cancel Registration</button>
                </div>
            </form>
            </form>
        </div>
    </div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
<script>
    function validateEmail(strEmail) {
    if (strEmail.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)) {
        return true;
    }
    return false;
};

txtPhoneNumber.addEventListener('input', function (e) {
    var x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
    e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
});

var txtZipCode = document.getElementById('txtZipCode');

txtZipCode.addEventListener('input', function (e) {
    var zipCode = e.target.value.replace(/\D/g, '').slice(0, 5);
    e.target.value = zipCode;
});


$('#btnLogin').on('click', function () {
    let strUsername = $('#txtUsername').val().trim();
    let strPassword = $('#txtPassword').val();
    let blnError = false;
    let strErrorMessage = '';

    if (strUsername == '') {
        blnError = true;
        strErrorMessage += "<h2>Email can't be blank!</h2>";
    } else if (!validateEmail(strUsername)) {
        blnError = true;
        strErrorMessage += "<h2>Email is invalid! Please try again.</h2>";
    }
    if (strPassword === '') {
        blnError = true;
        strErrorMessage += "<h2>Password can't be blank.</h2>";
    } else {
        let requirements = [];
        if (strPassword.trim().length < 8) {
            requirements.push("Password can't be shorter than 8 characters.");
        }
        if (!/[A-Z]/.test(strPassword)) {
            requirements.push("Password must contain at least one uppercase letter.");
        }
        if (!/[a-z]/.test(strPassword)) {
            requirements.push("Password must contain at least one lowercase letter.");
        }
        if (!/\d/.test(strPassword)) {
            requirements.push("Password must contain at least one number.");
        }
        if (!/[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-]/.test(strPassword)) {
            requirements.push("Password must contain at least one special character.");
        }
        if (requirements.length > 0) {
            blnError = true;
            strErrorMessage += "<h2>Password requirements not met:</h2>";
            strErrorMessage += "<ul>";
            requirements.forEach(req => {
                strErrorMessage += `<li>${req}</li>`;
            });
            strErrorMessage += "</ul>";
        }
    }
    // Starts swal messages //
    if (blnError == true) {
        Swal.fire({
            icon: 'error',
            title: 'Empty Fields',
            html: strErrorMessage,
        });
    } else {
        $.post('https://simplecoop.swollenhippo.com/sessions.php', { Email: strUsername, Password: strPassword }, function (sessionResult) {
            sessionResult = JSON.parse(Result);
            if (sessionResult.Error) {
                Swal.fire({
                    icon: 'error',
                    html: sessionResult.Error
                });
            } else if (sessionResult.Outcome == "false") {
                Swal.fire({
                    icon: 'error',
                    html: "Account Not Found"
                });
                $('#txtPassword').val('');
            } else {
                sessionStorage.setItem("SessionID", sessionResult.SessionID);
                setTimeout(function () {
                    Swal.close()
                    $('#registerCard').slideUp();
                    $('#loginCard').slideUp()
                })
            } 
        });
    }
});

$('#btnSignUp').on('click', function () {
    $('#loginCard').slideUp();
    $('#RegisterCard').slideDown();
});

$('#btnRegister').on('click', function () {
    let strEmail = $('#txtEmail').val().trim();
    let strRegisterPassword = $('#txtRegisterPassword').val();
    let strFirstName = $('#txtFirstName').val();
    let strLastName = $('#txtLastName').val();
    let strStreetAddress1 = $('#txtStreetAddress1').val();
    let strStreetAddress2 = $('#txtStreetAddress2').val();
    let strCity = $('#txtCity').val();
    let strState = $('#txtState').val();
    let strZipCode = $('#txtZipCode').val();
    let strPhoneNumber = $('#txtPhoneNumber').val();
    let strCoopID = $('#txtCoopID').val();

    let blnError = false;
    let strErrorMessage = '';

    if (strEmail == '') {
        blnError = true;
        strErrorMessage += "<h2>Email can't be blank.</h2>";
    } else if (!validateEmail(strEmail)) {
        blnError = true;
        strErrorMessage += "<h2>Email is invalid.</h2>";
    }

    if (strRegisterPassword === '') {
        blnError = true;
        strErrorMessage += "<h2>Password can't be blank.</h2>";
    } else {
        let requirements = [];
        //checking length requirment
        if (strRegisterPassword.trim().length < 8) {
            requirements.push("Password can't be shorter than 8 characters.");
        }
        //checking for uppercase letters
        if (!/[A-Z]/.test(strRegisterPassword)) {
            requirements.push("Password must contain at least one uppercase letter.");
        }
        //checking for lowercase letters
        if (!/[a-z]/.test(strRegisterPassword)) {
            requirements.push("Password must contain at least one lowercase letter.");
        }
        //checking for number
        if (!/\d/.test(strRegisterPassword)) {
            requirements.push("Password must contain at least one number.");
        }
        //chacking for special characters
        if (!/[!@#$%^&*()_+{}\[\]:;<>,.?~\\/-]/.test(strRegisterPassword)) {
            requirements.push("Password must contain at least one special character.");
        }
        if (requirements.length > 0) {
            blnError = true;
            strErrorMessage += "<h5>Password requirements not met:</h5>";
            strErrorMessage += "<ul>";
            requirements.forEach(req => {
            strErrorMessage += `<li>${req}</li>`;
            });
            strErrorMessage += "</ul>";
        }
    }
    if (strFirstName == '') {
        blnError = true;
        strErrorMessage += "<h2>First Name can't be blank.</h2>";
    }
    if (strLastName == '') {
        blnError = true;
        strErrorMessage += "<h2>Last Name can't be blank.</h2>";
    }
    if (strStreetAddress1 == '') {
        blnError = true;
        strErrorMessage += "<h2>Street Address can't be blank.</h2>";
    }
    if (strCity == '') {
        blnError = true;
        strErrorMessage += "<h2>City can't be blank.</h2>";
    }
    if (strState == '') {
        blnError = true;
        strErrorMessage += "<h2>State can't be blank.</h2>";
    }
    if (strZipCode == '') {
        blnError = true;
        strErrorMessage += "<h2>Zip Code can't be blank.</h2>";
    }
    if (strPhoneNumber == '') {
        blnError = true;
        strErrorMessage += "<h2>Phone Number can't be blank.</h2>";
    }
    if (strCoopID == '') {
        blnError = true;
        strErrorMessage += "<h2>Coop ID can't be blank.</h2>";
    }

    if (blnError == true) {
        Swal.fire({
            icon: 'error',
            title: 'Empty Fields',
            html: strErrorMessage,
        });
    } else {
        $.post('https://simplecoop.swollenhippo.com/users.php', { Email: strEmail, Password: strRegisterPassword, FirstName: strFirstName, LastName: strLastName, CoopID: strCoopID }, function (sessionResult) {
            sessionResult = JSON.parse(sessionResult);
            if (sessionResult.Error) {
                Swal.fire({
                    icon: 'error',
                    html: sessionResult.Error
                });
            } else {
                $.post('https://simplecoop.swollenhippo.com/useraddress.php', { Email: strEmail, Street1: strStreetAddress1, Street2: strStreetAddress2, City: strCity, State: strState, ZIP: strZipCode }, function (addressResult) {
                    addressResult = JSON.parse(addressResult);
                    if (addressResult.Error) {
                        Swal.fire({
                            icon: 'error',
                            html: addressResult.Error
                        });
                    } else {
                        $.post('https://simplecoop.swollenhippo.com/sessions.php', { Email: strEmail, Password: strRegisterPassword }, function (sessionResult) {
                            sessionResult = JSON.parse(sessionResult);
                            if (sessionResult.Error) {
                                Swal.fire({
                                    icon: 'error',
                                    html: sessionResult.Error
                                });
                            } else {
                                $.ajax({
                                    url: 'https://simplecoop.swollenhippo.com/coop.php',
                                    type: 'PUT',
                                    data: "SessionID=" + sessionResult.SessionID + "&Street1=" + strStreetAddress1 + "&Street2=" + strStreetAddress2 + "&City=" + strCity + "&State=" + strState + "&ZIP=" + strZipCode + "",
                                    success: function (data) {
                                        sessionStorage.setItem("SessionID", sessionResult.SessionID);
                                        Swal.fire({
                                            icon: 'success',
                                            title: 'Registration Successful',
                                            showConfirmButton: false
                                        });                                
                                    }})
                                }
                        });
                    }
                });
            }
        });
    }
});

$('#btnCancel').on('click', function () {
    $('#loginCard').slideDown();
    $('#RegisterCard').slideUp();
});

</script>
</body>
</html>